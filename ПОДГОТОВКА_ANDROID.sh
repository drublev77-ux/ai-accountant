#!/bin/bash

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# ü§ñ –ü–û–î–ì–û–¢–û–í–ö–ê ANDROID –ü–†–û–ï–ö–¢–ê (–ë–ï–ó –°–ë–û–†–ö–ò .AAB)
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç Android –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–±–æ—Ä–∫–∏
# –≤ —Å—Ä–µ–¥–µ —Å Android Studio –∏ Gradle
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

set -e

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
WHITE='\033[1;37m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${CYAN}‚ïë${WHITE}  ü§ñ –ü–û–î–ì–û–¢–û–í–ö–ê ANDROID –ü–†–û–ï–ö–¢–ê                    ${CYAN}‚ïë${NC}"
echo -e "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}\n"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo -e "${CYAN}[0/4]${NC} ${WHITE}–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è...${NC}"
echo -e "Node: $(node --version)"
echo -e "npm: $(npm --version)"
echo -e "${GREEN}‚úì${NC} –û–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!\n"

# –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo -e "${CYAN}[1/4]${NC} ${WHITE}–°–æ–±–∏—Ä–∞–µ–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...${NC}"
npm run build
echo -e "${GREEN}‚úì${NC} –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–æ!\n"

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ Android –ø—Ä–æ–µ–∫—Ç–∞
echo -e "${CYAN}[2/4]${NC} ${WHITE}–ü—Ä–æ–≤–µ—Ä–∫–∞ Android –ø—Ä–æ–µ–∫—Ç–∞...${NC}"
if [ ! -d "android" ]; then
    echo -e "${YELLOW}‚ö†${NC} Android –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–µ–º..."
    npx cap add android
    echo -e "${GREEN}‚úì${NC} Android –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω!"
else
    echo -e "${GREEN}‚úì${NC} Android –ø—Ä–æ–µ–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"
fi
echo ""

# –®–∞–≥ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Android
echo -e "${CYAN}[3/4]${NC} ${WHITE}–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Android –ø—Ä–æ–µ–∫—Ç–æ–º...${NC}"
npx cap sync android
echo -e "${GREEN}‚úì${NC} –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n"

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
echo -e "${CYAN}[4/4]${NC} ${WHITE}–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞...${NC}"
if [ -d "android/app/src/main" ]; then
    echo -e "${GREEN}‚úì${NC} –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è!"
else
    echo -e "${RED}‚úó${NC} –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–ø–æ–ª–Ω–∞—è!"
    exit 1
fi
echo ""

# –†–µ–∑—É–ª—å—Ç–∞—Ç
echo -e "${GREEN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${GREEN}‚ïë${WHITE}  ‚úÖ ANDROID –ü–†–û–ï–ö–¢ –ü–û–î–ì–û–¢–û–í–õ–ï–ù!                   ${GREEN}‚ïë${NC}"
echo -e "${GREEN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}\n"

echo -e "${WHITE}üìÅ –ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ:${NC} android/"
echo -e "${WHITE}üì¶ Web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:${NC} dist/\n"

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö E2B
echo -e "${YELLOW}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${YELLOW}‚ïë${WHITE}  ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø E2B –°–†–ï–î–´              ${YELLOW}‚ïë${NC}"
echo -e "${YELLOW}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}\n"

echo -e "${WHITE}–í —Ç–µ–∫—É—â–µ–π —Å—Ä–µ–¥–µ E2B –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:${NC}"
echo -e "  ‚ùå Java Development Kit (JDK)"
echo -e "  ‚ùå Android SDK"
echo -e "  ‚ùå Gradle Build Tool\n"

echo -e "${YELLOW}üöÄ –ß–¢–û –î–ê–õ–¨–®–ï:${NC}\n"

echo -e "${WHITE}–í–ê–†–ò–ê–ù–¢ 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)${NC}"
echo -e "  1. –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫ —Å–µ–±–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä"
echo -e "  2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Android Studio: https://developer.android.com/studio"
echo -e "  3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É 'android' –≤ Android Studio"
echo -e "  4. Build ‚Üí Generate Signed Bundle ‚Üí App Bundle (.aab)\n"

echo -e "${WHITE}–í–ê–†–ò–ê–ù–¢ 2: –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞${NC}"
echo -e "  1. –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç"
echo -e "  2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JDK 17+ –∏ Android SDK"
echo -e "  3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:"
echo -e "     cd android && ./gradlew bundleRelease\n"

echo -e "${WHITE}–í–ê–†–ò–ê–ù–¢ 3: CI/CD Pipeline${NC}"
echo -e "  1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ GitHub"
echo -e "  2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Actions —Å Android SDK"
echo -e "  3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º push\n"

# –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã
echo -e "${CYAN}üìö –ü–û–õ–ï–ó–ù–´–ï –§–ê–ô–õ–´:${NC}"
echo -e "  üìñ –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø_ANDROID_–î–ï–¢–ê–õ–¨–ù–û.md - –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"
echo -e "  üìñ –ú–û–ë–ò–õ–¨–ù–´–ï_–ü–†–ò–õ–û–ñ–ï–ù–ò–Ø_–ì–û–¢–û–í–û.md - –æ–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"
echo -e "  üìñ –ù–ê–ß–ê–¢–¨_–°–û–ó–î–ê–ù–ò–ï_–ü–†–ò–õ–û–ñ–ï–ù–ò–ô.txt - —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å\n"

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
echo -e "${CYAN}üìÇ –°–¢–†–£–ö–¢–£–†–ê ANDROID –ü–†–û–ï–ö–¢–ê:${NC}"
tree -L 2 android/ 2>/dev/null || find android/ -maxdepth 2 -type d | head -20

echo -e "\n${GREEN}‚ú® –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–±–æ—Ä–∫–µ –Ω–∞ –º–∞—à–∏–Ω–µ —Å Android Studio!${NC}\n"
